generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model buses {
  bus_id          Int       @id @default(autoincrement())
  bus_name        String?   @db.VarChar(255)
  route_id        Int?
  departure_time  DateTime  @db.Timestamp(6)
  price           Int
  seat_capacity   Int
  available_seats Int
  route           routes?   @relation(fields: [route_id], references: [route_id], onDelete: NoAction, onUpdate: NoAction, map: "bus_ibfk_1")
  tickets         tickets[]

  @@index([route_id], map: "idx_buses_route_id")
}

model cities {
  city_id          Int      @id @default(autoincrement())
  city_name        String   @db.VarChar(255)
  departure_routes routes[] @relation("DepartureCity")
  arrival_routes   routes[] @relation("ArrivalCity")
}

model routes {
  route_id          Int     @id @default(autoincrement())
  departure_city_id Int?
  arrival_city_id   Int?
  buses             buses[]
  departure_city    cities? @relation("DepartureCity", fields: [departure_city_id], references: [city_id], onDelete: NoAction, onUpdate: NoAction, map: "route_ibfk_1")
  arrival_city      cities? @relation("ArrivalCity", fields: [arrival_city_id], references: [city_id], onDelete: NoAction, onUpdate: NoAction, map: "route_ibfk_2")

  @@index([arrival_city_id], map: "idx_routes_arrival_city_id")
  @@index([departure_city_id], map: "idx_routes_departure_city_id")
}

model tickets {
  ticket_id        Int       @id @default(autoincrement())
  user_id          Int
  bus_id           Int
  no_seat          String    @db.VarChar(10)
  total_price      Int
  ticket_code      String    @db.VarChar(100)
  created_at       DateTime  @default(now()) @db.Timestamp(6)
  departure_city   String    // Required field - not null
  arrival_city     String    // Required field - not null  
  bus_name         String    // Required field - not null
  has_addons       Boolean   @default(false)
  date             DateTime  // Required field - not null (timestamptz)
  user             users     @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "ticket_ibfk_1")
  bus              buses     @relation(fields: [bus_id], references: [bus_id], onDelete: NoAction, onUpdate: NoAction, map: "ticket_ibfk_2")

  @@index([bus_id], map: "idx_tickets_bus_id")
  @@index([user_id], map: "idx_tickets_user_id")
}

model users {
  user_id    Int       @id @default(autoincrement())
  name       String    @db.VarChar(255)
  gender     String?   @db.VarChar(255)
  email      String    @unique(map: "idx_users_email") @db.VarChar(255)
  password   String    @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  tickets    tickets[]
}
